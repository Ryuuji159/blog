<!DOCTYPE html>
<html lang="es">
  <head>
    <title>Daniel Cortés</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width-device-width, initial-scale=1">
    <meta name="author" content="Daniel Cortés">
    <link rel="stylesheet" href="/assets/style.css" type="text/css">
    <link rel="icon" href="data:;base64,iVBORw0KGgo=">
  </head>
  <body>
    <div class="container">
      <h1>Cosas que olvido sobre SQL</h1>
<p><time datetime="2019-10-23"> Oct 23, 2019 </time></p>
<p>Si bien considero saber usar SQL al nivel suficiente con el cual hacer una 
aplicación simple, al menos nunca me he visto en la necesidad de ir mas allá de
hacer un left join, siempre olvido su sintaxis, por eso aquí mantendré una lista 
de comandos que uso constantemente.</p>
<p>Todos los datos son basados en MySQL, que es la base de datos que mas utilizo.</p>
<h2>1 - Crear tabla</h2>
<div class="codehilite"><pre><span></span><code><span class="k">create</span> <span class="k">table</span> <span class="n">usuario</span>
<span class="p">(</span>
 <span class="n">id</span>          <span class="nb">int</span>           <span class="k">primary</span> <span class="k">key</span> <span class="n">auto_increment</span><span class="p">,</span>
 <span class="n">nombre</span>      <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>  <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
 <span class="n">password</span>    <span class="nb">binary</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>    <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
 <span class="n">salt</span>        <span class="nb">binary</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>    <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
 <span class="n">trabajador</span>  <span class="nb">int</span>           <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
 <span class="k">foreign</span> <span class="k">key</span> <span class="p">(</span><span class="n">trabajador</span><span class="p">)</span>  <span class="k">references</span> <span class="n">trabajador</span> <span class="p">(</span><span class="n">id</span><span class="p">),</span>
 <span class="n">inserted_at</span> <span class="k">timestamp</span><span class="p">,</span>
 <span class="n">modified_at</span> <span class="k">timestamp</span><span class="p">,</span>
 <span class="p">);</span>
</code></pre></div>

<h2>2 - Como usar on delete y on update</h2>
<p>Cuando se crean foreign keys se tiene la opción de agregar on delete y on update 
constraints, siempre olvido exactamente que significa cada modo de estos 
constraints así que para ilustrarlos usare el siguiente modelo:</p>
<div class="codehilite"><pre><span></span><code><span class="k">create</span> <span class="k">table</span> <span class="n">trabajador</span>
<span class="p">(</span>
 <span class="n">id</span>     <span class="nb">int</span>           <span class="k">primary</span><span class="p">,</span>
 <span class="n">nombre</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>  <span class="k">not</span> <span class="k">null</span>
<span class="p">);</span>

<span class="k">create</span> <span class="k">table</span> <span class="n">usuario</span>
<span class="p">(</span>
 <span class="n">id</span>            <span class="nb">int</span>           <span class="k">primary</span> <span class="k">key</span><span class="p">,</span>
 <span class="n">nombre</span>        <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>  <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
 <span class="n">trabajador_id</span> <span class="nb">int</span>           <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
 <span class="k">foreign</span> <span class="k">key</span> <span class="p">(</span><span class="n">trabajador_id</span><span class="p">)</span> <span class="k">references</span> <span class="n">trabajador</span> <span class="k">on</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div>

<h3><code>ON UPDATE</code></h3>
<ul>
<li><code>RESTRICT</code> (default): Si es que se intenta actualizar el id de la tabla 
trabajador la operación sera rechazada mientras exista al menos un usuario 
que referencie a ese trabajador.</li>
<li><code>NO ACTION</code>: Lo mismo que <code>RESTRICT</code>.</li>
<li><code>CASCADE</code>: Si es que se intenta actualizar el id del trabajador, el id 
también sera actualizado en todos los usuarios que referencien al 
trabajador.</li>
<li><code>SET NULL</code>: Al cambiar el id del trabajador, las referencias a este id en
la tabla usuario se harán nulas.</li>
</ul>
<h3><code>ON DELETE</code></h3>
<ul>
<li><code>RESTRICT</code> (default): Si es que se intenta eliminar el trabajador la 
operación sera rechazada mientras exista al menos un usuario que tenga una 
referencia a ese trabajador.</li>
<li><code>NO ACTION</code>: Lo mismo que <code>RESTRICT</code>.</li>
<li><code>CASCADE</code>: Al eliminar un trabajador también se eliminaran todos los 
usuarios que tengan su id asociado.</li>
<li><code>SET NULL</code>: Cuando se elimine un trabajador, todas sus referencias en la 
tabla  usuarios sera llenadas con nulls.</li>
</ul>
<h2>3 - Creación de foreign keys fuera del create table</h2>
<div class="codehilite"><pre><span></span><code><span class="k">alter</span> <span class="k">table</span> <span class="n">usuario</span> <span class="k">add</span> <span class="k">constraint</span> <span class="n">fk_usuario_trabajador</span> 
<span class="k">foreign</span> <span class="k">key</span> <span class="p">(</span><span class="n">trabajador_id</span><span class="p">)</span> <span class="k">references</span> <span class="n">trabajador</span> <span class="p">(</span><span class="n">id</span><span class="p">);</span>
</code></pre></div>
    </div>
    <script>
      function makeImagesClickeable() {
        document.querySelectorAll("img").forEach(img => {
          img.addEventListener("click", e => window.open(e.target.src))
        });
      }

      window.addEventListener('load', (event) => {
        makeImagesClickeable();
      });
    </script>
  </body>
</html>